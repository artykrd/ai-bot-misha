# –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–ª—è Telegram-–±–æ—Ç–∞ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫

- **CPU Load Average** - –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
- **RAM** - –¥–æ—Å—Ç—É–ø–Ω–∞—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–º—è—Ç—å
- **Swap** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ swap-–ø–∞–º—è—Ç–∏
- **Disk** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
- **Uptime** - –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤

- **Webhook** (FastAPI) - http://127.0.0.1:8000/health
- **Redis** - –ø—Ä–æ–≤–µ—Ä–∫–∞ ping
- **PostgreSQL** - –ø—Ä–æ–≤–µ—Ä–∫–∞ SELECT 1

### 3. –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

#### –ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

**CPU Load (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π):**
- Warning: > 0.8
- Critical: > 1.2

**Available RAM:**
- Warning: < 300 MB
- Critical: < 150 MB

**Swap Usage:**
- Warning: > 200 MB

**–°–µ—Ä–≤–∏—Å—ã:**
- Critical: –ª—é–±–æ–π —Å–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

#### –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞

- **Warning alerts:** –Ω–µ —á–∞—â–µ 1 —Ä–∞–∑–∞ –≤ 15 –º–∏–Ω—É—Ç
- **Critical alerts:** –Ω–µ —á–∞—â–µ 1 —Ä–∞–∑–∞ –≤ 5 –º–∏–Ω—É—Ç

### 4. –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á—ë—Ç—ã

–û—Ç—á—ë—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 03:00 UTC –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç:

- –°—Ä–µ–¥–Ω–∏–π –∏ –ø–∏–∫–æ–≤—ã–π CPU load
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π RAM
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Swap
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –∑–∞ —Å—É—Ç–∫–∏
- Uptime —Å–µ—Ä–≤–µ—Ä–∞
- –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
app/monitoring/
‚îú‚îÄ‚îÄ __init__.py           # –≠–∫—Å–ø–æ—Ä—Ç SystemMonitor
‚îú‚îÄ‚îÄ metrics.py            # –°–±–æ—Ä—â–∏–∫ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ (psutil)
‚îú‚îÄ‚îÄ health_checks.py      # –ü—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
‚îú‚îÄ‚îÄ notifier.py           # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram
‚îú‚îÄ‚îÄ daily_report.py       # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤
‚îî‚îÄ‚îÄ monitor.py            # –ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### main.py

```python
from app.monitoring import SystemMonitor

# –í —Ñ—É–Ω–∫—Ü–∏–∏ main():
monitor = SystemMonitor()
monitor.start()  # –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

# –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏:
await monitor.stop()
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (.env)

```bash
# Admin bot token –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
TELEGRAM_ADMIN_BOT_TOKEN=your_admin_bot_token

# Admin user IDs (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
ADMIN_USER_IDS=123456789,987654321
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Loop** (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç):
   - –°–æ–±–∏—Ä–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç alerts –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤ Redis –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤

2. **–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á—ë—Ç** (03:00 UTC):
   - –ê–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –∑–∞ 24 —á–∞—Å–∞
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç—á—ë—Ç –∞–¥–º–∏–Ω–∞–º
   - –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫ –æ—à–∏–±–æ–∫

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**:
   - –í—Å–µ ERROR/CRITICAL –ª–æ–≥–∏ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è
   - –°—á—ë—Ç—á–∏–∫ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞

## –ü—Ä–∏–º–µ—Ä—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### Warning Alert

```
‚ö†Ô∏è MONITORING WARNING

üìä –¢–∏–ø: CPU Load
üìù –°–æ–æ–±—â–µ–Ω–∏–µ: CPU load is high: 0.95

üìã –î–µ—Ç–∞–ª–∏:
  ‚Ä¢ load_average: 0.95
  ‚Ä¢ threshold: 0.8
  ‚Ä¢ cpu_percent: 78.5

üïê –í—Ä–µ–º—è: 2026-01-11 10:30:45 UTC
```

### Critical Alert

```
üî¥ MONITORING CRITICAL

üìä –¢–∏–ø: Memory
üìù –°–æ–æ–±—â–µ–Ω–∏–µ: Available RAM is critically low: 120 MB

üìã –î–µ—Ç–∞–ª–∏:
  ‚Ä¢ available_mb: 120
  ‚Ä¢ threshold_mb: 150
  ‚Ä¢ used_percent: 92.3

üïê –í—Ä–µ–º—è: 2026-01-11 10:30:45 UTC
```

### Daily Report

```
üìä –ï–ñ–ï–î–ù–ï–í–ù–´–ô –û–¢–ß–Å–¢ –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê

üìÖ –î–∞—Ç–∞: 2026-01-11

üîÑ CPU
  ‚Ä¢ –°—Ä–µ–¥–Ω–∏–π load: 0.45
  ‚Ä¢ –ü–∏–∫–æ–≤—ã–π load: 1.05

üíæ –ü–∞–º—è—Ç—å
  ‚Ä¢ –ú–∏–Ω–∏–º—É–º –¥–æ—Å—Ç—É–ø–Ω–æ: 256 MB
  ‚Ä¢ –°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è: 65.3%

üíø Swap
  ‚Ä¢ –ú–∞–∫—Å–∏–º—É–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: 120 MB

üì¶ –î–∏—Å–∫
  ‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: 45.2%
  ‚Ä¢ –°–≤–æ–±–æ–¥–Ω–æ: 85.3 GB

‚ùå –û—à–∏–±–∫–∏
  ‚Ä¢ –í—Å–µ–≥–æ –∑–∞ —Å—É—Ç–∫–∏: 3

‚è± Uptime
  ‚Ä¢ –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: 168.5 —á–∞—Å–æ–≤

‚úÖ –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
  ‚Ä¢ Webhook: healthy
  ‚Ä¢ Redis: healthy
  ‚Ä¢ PostgreSQL: healthy

üïê –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: 2026-01-11 03:00:15 UTC
```

## API –¥–ª—è —Ä—É—á–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫

```python
from app.monitoring.monitor import system_monitor

# –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
status = await system_monitor.get_current_status()

# –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç:
# - metrics: –≤—Å–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
# - services: —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
# - thresholds: –ø–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.10+
- psutil==5.9.8
- Redis (–¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫)
- TELEGRAM_ADMIN_BOT_TOKEN –≤ .env

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π** - —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π asyncio –∑–∞–¥–∞—á–µ
2. **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤—ã–π** - –æ—à–∏–±–∫–∏ –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ –Ω–µ –ª–æ–º–∞—é—Ç –±–æ—Ç–∞
3. **–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ –∏–Ω–≤–∞–∑–∏–≤–Ω—ã–π** - –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
4. **–ü—Ä–æ–¥–∞–∫—à–µ–Ω-ready** - throttling, error handling, logging
5. **–ú–æ–¥—É–ª—å–Ω—ã–π** - –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
python -m py_compile app/monitoring/*.py

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
python scripts/test_monitoring.py
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ —Å–æ–±—ã—Ç–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:

- `monitoring_started` - –∑–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- `monitoring_check_completed` - —É—Å–ø–µ—à–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
- `monitoring_alert_sent` - –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- `daily_report_sent` - –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á—ë—Ç
- `monitoring_stopped` - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π admin bot token
- Markdown escaping –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è injection
- Timeout –¥–ª—è –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- Throttling –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Å–ø–∞–º–∞
