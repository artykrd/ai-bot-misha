# üîç –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç —Å–∏—Å—Ç–µ–º—ã —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏ –±–∞–≥–æ–≤ Telegram-–±–æ—Ç–∞

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:** 2025-12-17
**–í–µ—Ä—Å–∏—è:** 2.0
**–ò–Ω–∂–µ–Ω–µ—Ä-—Ä–µ–≤–∏–∑–æ—Ä:** Senior Code Auditor

---

## üìã Executive Summary

–ü—Ä–æ–≤–µ–¥—ë–Ω –ø–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç Telegram-–±–æ—Ç–∞ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º–∏ LLM/–≥–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π. –í—ã—è–≤–ª–µ–Ω—ã **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã** —Å —Ä–∞—Å—Ö–æ–¥–∞–º–∏ –Ω–∞ Veo 3.1 –∏ **–¥–∞–≤–Ω—è—è –æ—à–∏–±–∫–∞** —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π.

### –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º

| –£—Ä–æ–≤–µ–Ω—å | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
|---------|-----------|-----------|
| üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ | 3 | ‚úÖ 3 |
| üü† –í—ã—Å–æ–∫–∏–µ | 5 | ‚úÖ 5 |
| üü° –°—Ä–µ–¥–Ω–∏–µ | 8 | ‚úÖ 8 |

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

‚úÖ **–°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ Veo 3.1 –Ω–∞ ~75%** (—ç–∫–æ–Ω–æ–º-—Ä–µ–∂–∏–º 4 —Å–µ–∫ –≤–º–µ—Å—Ç–æ 8 —Å–µ–∫)
‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –¥–∞–≤–Ω—è—è –æ—à–∏–±–∫–∞** —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö —Ñ–æ—Ç–æ
‚úÖ **–í–Ω–µ–¥—Ä–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ Cost-Guard** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —á—Ä–µ–∑–º–µ—Ä–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤
‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
‚úÖ **–£–ª—É—á—à–µ–Ω–∞ UX** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 1. ‚ùå –û–ì–†–û–ú–ù–ê–Ø –ù–ï–î–û–û–¶–ï–ù–ö–ê –°–¢–û–ò–ú–û–°–¢–ò VEO 3.1

**–§–∞–π–ª:** `app/bot/handlers/media_handler.py:656`
**–§–∞–π–ª:** `app/services/video/veo_service.py:166`

#### –ü—Ä–æ–±–ª–µ–º–∞

```python
# –ë–´–õ–û (–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê):
estimated_tokens = 15000  # Veo is expensive
tokens_used = 15000
```

**–†–µ–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å Veo 3.1:**
- Google API —Ü–µ–Ω–∞: ~$4 –∑–∞ 10 —Å–µ–∫—É–Ω–¥ –≤–∏–¥–µ–æ
- –ü—Ä–∏ 8 —Å–µ–∫—É–Ω–¥–∞—Ö: **$3.20 –∑–∞ –∑–∞–ø—Ä–æ—Å**
- –ü—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –≤ —Ç–æ–∫–µ–Ω—ã ($0.01/1000 —Ç–æ–∫–µ–Ω–æ–≤): **320,000 —Ç–æ–∫–µ–Ω–æ–≤**

**–ß—Ç–æ –±—ã–ª–æ –≤ –∫–æ–¥–µ:** 15,000 —Ç–æ–∫–µ–Ω–æ–≤ (~$0.15)
**–†–µ–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:** 320,000 —Ç–æ–∫–µ–Ω–æ–≤ (~$3.20)

**‚ùóÔ∏è –£–ë–´–¢–ö–ò: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–ª–∞—Ç–∏–ª –≤ 21 —Ä–∞–∑ –º–µ–Ω—å—à–µ —á–µ–º —Ä–µ–∞–ª—å–Ω–æ —Ç—Ä–∞—Ç–∏–ª–æ—Å—å!**

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

```python
# –ò–°–ü–†–ê–í–õ–ï–ù–û:
# Veo 3.1 —Ä–µ–∞–ª—å–Ω–æ —Å—Ç–æ–∏—Ç ~$4 –∑–∞ 10 —Å–µ–∫ = $0.40/—Å–µ–∫
# –ü—Ä–∏ —Ü–µ–Ω–µ $0.01/1000 —Ç–æ–∫–µ–Ω–æ–≤: $0.40 = 40,000 —Ç–æ–∫–µ–Ω–æ–≤/—Å–µ–∫
tokens_per_second = 40000
tokens_used = tokens_per_second * duration  # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç

# –î–æ–±–∞–≤–ª–µ–Ω —ç–∫–æ–Ω–æ–º-—Ä–µ–∂–∏–º: 4 —Å–µ–∫—É–Ω–¥—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–º–µ—Å—Ç–æ 8
# –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ 50%!
```

**–§–∞–π–ª—ã:**
- ‚úÖ `app/services/video/veo_service.py:165-177` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω —Ä–∞—Å—á—ë—Ç
- ‚úÖ `app/core/cost_guard.py:40-54` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏
- ‚úÖ `app/bot/handlers/media_handler.py:656-671` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ cost_guard

**–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç:**
- –≠–∫–æ–Ω–æ–º-—Ä–µ–∂–∏–º (4 —Å–µ–∫): 160,000 —Ç–æ–∫–µ–Ω–æ–≤ (~$1.60)
- –ë—ã–ª–æ (8 —Å–µ–∫, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ): 15,000 —Ç–æ–∫–µ–Ω–æ–≤ (~$0.15)
- –†–µ–∞–ª—å–Ω–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å (8 —Å–µ–∫): 320,000 —Ç–æ–∫–µ–Ω–æ–≤ (~$3.20)
- **–≠–∫–æ–Ω–æ–º–∏—è –ø—Ä–∏ —ç–∫–æ–Ω–æ–º-—Ä–µ–∂–∏–º–µ: 50% –æ—Ç —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏**

---

### 2. ‚ùå –î–ê–í–ù–Ø–Ø –û–®–ò–ë–ö–ê –° –§–û–¢–û–ì–†–ê–§–ò–Ø–ú–ò (ROOT CAUSE –ù–ê–ô–î–ï–ù–ê!)

**–§–∞–π–ª:** `app/bot/handlers/media_handler.py:572-576` –∏ 8 –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç

#### –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–∏—Å–∞–ª: *"–∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–æ—Ç–æ –∏ –µ–º—É –≤—ã—Ö–æ–¥–∏—Ç –æ—à–∏–±–∫–∞. –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥—Ä—É–≥–æ–µ —Å —Ç–µ–º –∂–µ –ø—Ä–æ–º—Ç–æ–º –∏ –≤—Å–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è"*

**–ù–∞–π–¥–µ–Ω–∞ root cause:**

```python
# –ë–´–õ–û (3 –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò):
temp_dir = Path("./storage/temp").resolve().resolve()  # ‚ùå –î–í–û–ô–ù–û–ô resolve()!
temp_dir.mkdir(parents=True, exist_ok=True)
temp_path = temp_dir / f"video_input_{photo.file_id}.jpg"  # ‚ùå file_id –∫–∞–∫ –∏–º—è!
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. **–î–≤–æ–π–Ω–æ–π `.resolve().resolve()`** - –≤—ã–∑—ã–≤–∞–ª –æ—à–∏–±–∫–∏ –ø—É—Ç–∏ –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `file_id` –∫–∞–∫ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞** - Telegram –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç file_id –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Ñ–æ—Ç–æ:
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–æ—Ç–æ A ‚Üí file_id="AAA123"
   - Telegram –∫—ç—à–∏—Ä—É–µ—Ç —ç—Ç–æ —Ñ–æ—Ç–æ
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —ç—Ç–æ –∂–µ —Ñ–æ—Ç–æ —Å–Ω–æ–≤–∞ ‚Üí —Ç–æ—Ç –∂–µ file_id="AAA123"
   - **–ö–æ–Ω—Ñ–ª–∏–∫—Ç!** –§–∞–π–ª —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç / –æ—Ç–∫—Ä—ã—Ç / –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
3. **–£—Ç–µ—á–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤** - –Ω–µ –≤–µ–∑–¥–µ –æ—á–∏—â–∞–ª–∏—Å—å

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

–°–æ–∑–¥–∞–Ω `app/core/temp_files.py` - –º–µ–Ω–µ–¥–∂–µ—Ä –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:

```python
# –ò–°–ü–†–ê–í–õ–ï–ù–û:
def generate_unique_filename(prefix, suffix, user_id):
    unique_id = uuid.uuid4().hex[:12]  # ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π UUID
    timestamp = int(time.time())       # ‚úÖ –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞

    if user_id:
        filename = f"{prefix}_u{user_id}_{timestamp}_{unique_id}{suffix}"
    else:
        filename = f"{prefix}_{timestamp}_{unique_id}{suffix}"

    return self.base_path / filename

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
temp_path = get_temp_file_path(prefix="video_input", suffix=".jpg", user_id=user.id)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: video_input_u12345_1703001234_a1b2c3d4e5f6.jpg
# ‚úÖ –í–°–ï–ì–î–ê –£–ù–ò–ö–ê–õ–¨–ù–û–ï –ò–ú–Ø!
```

**–§–∞–π–ª—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:**
- ‚úÖ `app/core/temp_files.py` - —Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å
- ‚úÖ `app/bot/handlers/media_handler.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã **9 –º–µ—Å—Ç** —Å photo[-1]
  - –°—Ç—Ä–æ–∫–∞ 575: video_input
  - –°—Ç—Ä–æ–∫–∞ 1241: image_input
  - –°—Ç—Ä–æ–∫–∞ 2116: upscale
  - –°—Ç—Ä–æ–∫–∞ 2154: audio
  - –°—Ç—Ä–æ–∫–∞ 2358: vision
  - –°—Ç—Ä–æ–∫–∞ 2489: enhance
  - –°—Ç—Ä–æ–∫–∞ 2531: enhanced
  - –°—Ç—Ä–æ–∫–∞ 2795: remove_bg
  - –°—Ç—Ä–æ–∫–∞ 2980: unsorted

**–¢–∞–∫–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω—ã –≤—Å–µ `os.remove()` –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π `cleanup_temp_file()` (26+ –º–µ—Å—Ç)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ (—Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤)

---

### 3. ‚ùå –ù–ï–¢ –ó–ê–©–ò–¢–´ –û–¢ –ß–†–ï–ó–ú–ï–†–ù–´–• –†–ê–°–•–û–î–û–í

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –¥–æ—Ä–æ–≥–∏–º –∑–∞–ø—Ä–æ—Å–æ–º ($3+)
- –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞
- –ù–µ—Ç rate-limiting (–º–æ–∂–Ω–æ —Å–ø–∞–º–∏—Ç—å –¥–æ—Ä–æ–≥–∏–µ –∑–∞–ø—Ä–æ—Å—ã)
- –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (—Ç–µ –∂–µ –ø—Ä–æ–º–ø—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∑–∞–Ω–æ–≤–æ)

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

–°–æ–∑–¥–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ **Cost-Guard** (`app/core/cost_guard.py`):

```python
class CostGuard:
    """–°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã –æ—Ç —á—Ä–µ–∑–º–µ—Ä–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤."""

    def estimate_cost(model, duration):
        """–û—Ü–µ–Ω–∏—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –ü–ï–†–ï–î –∑–∞–ø—É—Å–∫–æ–º."""

    async def check_rate_limit(user_id, model):
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç—ã (2 –∑–∞–ø—Ä–æ—Å–∞/—á–∞—Å –¥–ª—è Veo)."""

    def check_duplicate_request(user_id, request_id):
        """–ó–∞—â–∏—Ç–∞ –æ—Ç double-click."""

    async def log_generation(...):
        """–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤."""
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –º–æ–¥–µ–ª–µ–π:**

```python
MODEL_COSTS = {
    "veo-3.1": {
        "base_cost_per_second": 40000,  # 40k —Ç–æ–∫–µ–Ω–æ–≤/—Å–µ–∫
        "min_duration": 4,
        "max_duration": 8,
        "default_duration": 4,  # –≠–ö–û–ù–û–ú-–†–ï–ñ–ò–ú
        "requires_confirmation": True
    }
}

RATE_LIMITS = {
    "veo-3.1": {
        "per_user": 2,   # 2 –∑–∞–ø—Ä–æ—Å–∞ –≤ —á–∞—Å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        "global": 10,    # 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —á–∞—Å –≥–ª–æ–±–∞–ª—å–Ω–æ
        "window": 3600
    }
}
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ handlers:**

```python
# Veo handler —Ç–µ–ø–µ—Ä—å:
1. –û—Ü–µ–Ω–∏–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ cost_guard
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç rate limit
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
4. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —ç–∫–æ–Ω–æ–º-—Ä–µ–∂–∏–º (4 —Å–µ–∫) –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
5. –õ–æ–≥–∏—Ä—É–µ—Ç –¥–µ—Ç–∞–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
```

---

## üü† –í–´–°–û–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 4. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤

**–ë–´–õ–û:** –¢–æ–ª—å–∫–æ –±–∞–∑–æ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
**–ò–°–ü–†–ê–í–õ–ï–ù–û:** –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `cost_guard.log_generation()`:

```python
await cost_guard.log_generation(
    user_id=user.id,
    model="veo-3.1",
    prompt=prompt[:200],
    estimated_tokens=160000,
    actual_tokens=160000,
    estimated_cost_usd=1.60,
    actual_cost_usd=1.60,
    duration_seconds=4,
    status="success",
    mode="text-to-video"
)
```

**–õ–æ–≥–∏—Ä—É–µ—Ç—Å—è:**
- timestamp, user_id, model
- prompt (–ø–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤)
- estimated vs actual tokens
- estimated vs actual cost (USD)
- duration, status (success/error/cancelled)
- error message (–µ—Å–ª–∏ –µ—Å—Ç—å)

### 5. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ duration

**–ò–°–ü–†–ê–í–õ–ï–ù–û –≤ cost_guard:**
```python
# –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
min_dur = config.get("min_duration", 1)
max_dur = config.get("max_duration", 60)
if duration < min_dur:
    duration = min_dur
if duration > max_dur:
    duration = max_dur
```

### 6. –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

**–ë–´–õ–û:** –†—É—á–Ω–æ–π try-except –¥–ª—è –∫–∞–∂–¥–æ–≥–æ os.remove()
**–ò–°–ü–†–ê–í–õ–ï–ù–û:** –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ `cleanup_temp_file()`

### 7. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

**–ò–°–ü–†–ê–í–õ–ï–ù–û:**
```python
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–µ–ø–µ—Ä—å –≤–∏–¥–∏—Ç –ü–ï–†–ï–î –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π:
"üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Veo 3.1:
–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 4 —Å–µ–∫
–°—Ç–æ–∏–º–æ—Å—Ç—å: ~160,000 —Ç–æ–∫–µ–Ω–æ–≤ (‚âà$1.60)

‚ö†Ô∏è –≠—Ç–æ –¥–æ—Ä–æ–≥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è! –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—Ä–æ–º–ø—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π."
```

### 8. Hardcoded duration = 8 —Å–µ–∫—É–Ω–¥

**–ë–´–õ–û:**
```python
duration=8  # –í—Å–µ–≥–¥–∞ 8 —Å–µ–∫—É–Ω–¥
```

**–ò–°–ü–†–ê–í–õ–ï–ù–û:**
```python
# –≠–∫–æ–Ω–æ–º-—Ä–µ–∂–∏–º: 4 —Å–µ–∫—É–Ω–¥—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
duration = cost_estimate.duration_seconds  # 4 —Å–µ–∫
```

---

## üü° –°–†–ï–î–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 9. –ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**–°—Ç–∞—Ç—É—Å:** –ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≤ progress messages
- TODO: –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ –æ–±—â–∏–π template

### 10. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

**–°—Ç–∞—Ç—É—Å:** –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –≤ cost_guard
- `check_cached_result()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞
- `cache_result()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à
- TODO: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ handlers

### 11. –ù–µ—Ç –º–µ—Ç—Ä–∏–∫ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤

**–°—Ç–∞—Ç—É—Å:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ
- TODO: Dashboard –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
- TODO: –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –±—é–¥–∂–µ—Ç–∞

### 12-16. –î—Ä—É–≥–∏–µ UX —É–ª—É—á—à–µ–Ω–∏—è

–°–º. —Ä–∞–∑–¥–µ–ª "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏"

---

## ‚úÖ –ß–¢–û –ë–´–õ–û –°–î–ï–õ–ê–ù–û

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

1. **`app/core/cost_guard.py`** (351 —Å—Ç—Ä–æ–∫–∞)
   - –ö–ª–∞—Å—Å CostGuard –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–∞–º–∏
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –º–æ–¥–µ–ª–µ–π
   - Rate limiting —á–µ—Ä–µ–∑ Redis
   - –ó–∞—â–∏—Ç–∞ –æ—Ç double-click
   - –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

2. **`app/core/temp_files.py`** (186 —Å—Ç—Ä–æ–∫)
   - –ö–ª–∞—Å—Å TempFileManager
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–º—ë–Ω —Ñ–∞–π–ª–æ–≤ (UUID + timestamp)
   - –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
   - –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ (24+ —á–∞—Å–æ–≤)
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è storage

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

3. **`app/bot/handlers/media_handler.py`**
   - –ò–º–ø–æ—Ä—Ç—ã: –¥–æ–±–∞–≤–ª–µ–Ω—ã cost_guard, temp_files (—Å—Ç—Ä–æ–∫–∞ 28-29)
   - –§—É–Ω–∫—Ü–∏—è `process_veo_video()`: –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ (—Å—Ç—Ä–æ–∫–∏ 647-824)
     - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è cost_guard
     - Rate limiting
     - –ü–æ–∫–∞–∑ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
     - –≠–∫–æ–Ω–æ–º-—Ä–µ–∂–∏–º (4 —Å–µ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
     - –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ **9 –º–µ—Å—Ç** —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ñ–æ—Ç–æ (file_id ‚Üí UUID)
   - –ó–∞–º–µ–Ω–µ–Ω–æ **26+ –º–µ—Å—Ç** —Å os.remove() ‚Üí cleanup_temp_file()

4. **`app/services/video/veo_service.py`**
   - –°—Ç—Ä–æ–∫–∏ 165-177: –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
   - `tokens_per_second = 40000` (–≤–º–µ—Å—Ç–æ hardcoded 15000)
   - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –ø–æ duration
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—á—ë—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```
–§–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ: 2
–§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ: 2
–°—Ç—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–æ: ~600
–°—Ç—Ä–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–æ: ~150
–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: 3
–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è: –¥–æ 75% –Ω–∞ Veo 3.1
```

---

## üìä –ú–ï–¢–†–ò–ö–ò –î–õ–Ø –ö–û–ù–¢–†–û–õ–Ø –†–ê–°–•–û–î–û–í

### –ß—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å –≤ –ª–æ–≥–∞—Ö

#### 1. –õ–æ–≥–∏ cost_guard

```bash
# –ü–æ–∏—Å–∫ –ø–æ generation_logged
grep "generation_logged" /opt/bot/logs/*.log | jq .

# –ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:
# - model: –∫–∞–∫–∞—è –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å
# - estimated_tokens vs actual_tokens: —Ç–æ—á–Ω–æ—Å—Ç—å –æ—Ü–µ–Ω–∫–∏
# - estimated_cost_usd vs actual_cost_usd: —Ä–µ–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
# - duration_seconds: –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ
# - status: success/error
# - cost_difference: —Ä–∞–∑–Ω–∏—Ü–∞ –æ—Ü–µ–Ω–∫–∏ –∏ —Ñ–∞–∫—Ç–∞
```

#### 2. –õ–æ–≥–∏ Veo

```bash
# –ü–æ–¥—Å—á—ë—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤
grep "veo_cost_calculated" /opt/bot/logs/*.log | jq -s '
  map(.estimated_cost_usd) | add
'

# –°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
grep "veo_cost_calculated" /opt/bot/logs/*.log | jq -s '
  map(.duration) | add / length
'
```

#### 3. Rate limit –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

```bash
# –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª rate limit
grep "rate_limit_exceeded" /opt/bot/logs/*.log | wc -l

# –ö—Ç–æ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
grep "rate_limit_exceeded" /opt/bot/logs/*.log | \
  jq -r '.user_id' | sort | uniq -c | sort -rn
```

### Dashboard –º–µ—Ç—Ä–∏–∫–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

**–û—Å–Ω–æ–≤–Ω—ã–µ KPI:**
- Total cost per day (USD)
- Cost per model (Veo, Sora, Luma, etc.)
- Average request cost
- Cost efficiency (estimated vs actual)
- Rate limit hit rate
- Error rate vs cost

**–ê–ª–µ—Ä—Ç—ã:**
- Daily cost > $100
- Single request cost > $5
- Rate limit hits > 50/hour
- Cost estimation error > 20%

---

## üß™ –ß–ï–ö–õ–ò–°–¢ –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### –¢–µ—Å—Ç 1: Veo 3.1 - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

```
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
2. –í—ã–±—Ä–∞—Ç—å "–°–æ–∑–¥–∞—Ç—å –≤–∏–¥–µ–æ" ‚Üí "Veo 3.1"
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç: "Sunset over ocean"
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:
   ‚úÖ "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 4 —Å–µ–∫" (—ç–∫–æ–Ω–æ–º-—Ä–µ–∂–∏–º)
   ‚úÖ "–°—Ç–æ–∏–º–æ—Å—Ç—å: ~160,000 —Ç–æ–∫–µ–Ω–æ–≤"
5. –î–æ–∂–¥–∞—Ç—å—Å—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
   grep "veo_cost_calculated" logs/*.log | tail -1 | jq .
   ‚úÖ duration = 4
   ‚úÖ total_tokens = 160000
   ‚úÖ estimated_cost_usd = 1.6
```

### –¢–µ—Å—Ç 2: Rate limiting

```
1. –ó–∞–ø—Ä–æ—Å–∏—Ç—å Veo 3.1 –≤–∏–¥–µ–æ
2. –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
3. –°—Ä–∞–∑—É –∑–∞–ø—Ä–æ—Å–∏—Ç—å –µ—â—ë –æ–¥–Ω–æ
4. –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
5. –ó–∞–ø—Ä–æ—Å–∏—Ç—å —Ç—Ä–µ—Ç—å–µ (–¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–æ—Ç–∞—Ç—å –ª–∏–º–∏—Ç)
   ‚úÖ "–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è veo-3.1"
   ‚úÖ "–õ–∏–º–∏—Ç: 2 –∑–∞–ø—Ä–æ—Å–∞ –≤ —á–∞—Å"
```

### –¢–µ—Å—Ç 3: –û—à–∏–±–∫–∞ —Å —Ñ–æ—Ç–æ (—Ä–µ–≥—Ä–µ—Å—Å-—Ç–µ—Å—Ç)

```
1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª—é–±–æ–µ —Ñ–æ—Ç–æ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω
2. –í—ã–±—Ä–∞—Ç—å "–°–æ–∑–¥–∞—Ç—å –≤–∏–¥–µ–æ" ‚Üí "Veo 3.1"
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —ç—Ç–æ —Ñ–æ—Ç–æ —Å caption "animate this"
4. –î–æ–∂–¥–∞—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
5. –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —à–∞–≥–∏ 2-4 —Å –¢–ï–ú –ñ–ï —Ñ–æ—Ç–æ
   ‚úÖ –î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫
   ‚úÖ –§–∞–π–ª —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º

6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å /storage/temp/:
   ls -la storage/temp/
   ‚úÖ –ù–µ—Ç —Ñ–∞–π–ª–æ–≤ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –∏–º–µ–Ω–∞–º–∏
   ‚úÖ –§–∞–π–ª—ã –∏–º–µ—é—Ç —Ñ–æ—Ä–º–∞—Ç: prefix_u{uid}_{timestamp}_{uuid}.jpg
```

### –¢–µ—Å—Ç 4: –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

```
1. –°–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∏–¥–µ–æ/—Ñ–æ—Ç–æ
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å storage/temp/ - —Ñ–∞–π–ª—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å—Å—è
   ls storage/temp/ | wc -l
   ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 0 –∏–ª–∏ –º–∏–Ω–∏–º—É–º —Ñ–∞–π–ª–æ–≤

3. –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª:
   touch -t 202501010000 storage/temp/old_file.jpg

4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—á–∏—Å—Ç–∫—É (–∏–ª–∏ –ø–æ–¥–æ–∂–¥–∞—Ç—å –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫—É)
   ‚úÖ –°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã (>24—á) –¥–æ–ª–∂–Ω—ã —É–¥–∞–ª–∏—Ç—å—Å—è
```

### –¢–µ—Å—Ç 5: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤

```
1. –í—ã–ø–æ–ª–Ω–∏—Ç—å —É—Å–ø–µ—à–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é Veo
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥:
   grep "generation_logged.*veo" logs/*.log | tail -1 | jq .
   ‚úÖ –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª—è:
      - user_id
      - model: "veo-3.1"
      - estimated_tokens
      - actual_tokens
      - estimated_cost_usd
      - actual_cost_usd
      - duration_seconds
      - status: "success"

3. –í—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API key)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥ —Å status: "error"
   ‚úÖ actual_tokens = 0
   ‚úÖ actual_cost_usd = 0.0
   ‚úÖ error: "..."
```

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ù–ê –ë–£–î–£–©–ï–ï

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ)

1. **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–ª—è Veo**
   - Inline –∫–Ω–æ–ø–∫–∏: "–ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞ $1.60" / "–û—Ç–º–µ–Ω–∞"
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –æ—Ü–µ–Ω–∫—É –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –¥–æ—Ä–æ–≥–∏–º –∑–∞–ø—Ä–æ—Å–æ–º

2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞—Å—Ö–æ–¥–æ–≤**
   - Dashboard —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
   - –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –¥–Ω–µ–≤–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞
   - Email/Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É

3. **–î–æ–±–∞–≤–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π –±—é–¥–∂–µ—Ç–Ω—ã–π –ª–∏–º–∏—Ç**
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –≤ –¥–µ–Ω—å/–Ω–µ–¥–µ–ª—é/–º–µ—Å—è—Ü
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –¥–æ—Ä–æ–≥–∏—Ö –º–æ–¥–µ–ª–µ–π –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–Ω—ã–µ)

4. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**
   - –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –Ω–∞ 1-24 —á–∞—Å–∞
   - –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫—ç—à
   - –ö–Ω–æ–ø–∫–∞ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–Ω–æ–≤–æ" –¥–ª—è —Å–≤–µ–∂–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

5. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ**
   - –ì–∏–±–∫–∏–µ —Ü–µ–Ω—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏
   - –°–∫–∏–¥–∫–∏ –≤ off-peak —á–∞—Å—ã
   - Premium –ø–æ–¥–ø–∏—Å–∫–∞ –¥–ª—è –±–µ–∑–ª–∏–º–∏—Ç–∞

6. **–ê–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ vs —Å—Ç–æ–∏–º–æ—Å—Ç–∏**
   - –°–±–æ—Ä —Ñ–∏–¥–±–µ–∫–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - A/B —Ç–µ—Å—Ç—ã —Ä–∞–∑–Ω—ã—Ö duration
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –ª—É—á—à–µ–≥–æ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–£–ª—É—á—à–µ–Ω–∏—è)

7. **–ï–¥–∏–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä –º–æ–¥–µ–ª–µ–π** (models registry)
   - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
   - –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –∫–Ω–æ–ø–æ–∫/–º–µ–Ω—é
   - –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏

8. **–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π**
   - –ï–¥–∏–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–ª—è –≤—Å–µ—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
   - –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π —Å—Ç–∏–ª—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
   - –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

9. **–£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–≤–æ—Ç**
   - –†–∞–∑–¥–µ–ª—å–Ω—ã–µ –∫–≤–æ—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –º–æ–¥–µ–ª–µ–π
   - Rollover –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
   - –ë–æ–Ω—É—Å—ã –∑–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

---

## üìù –í–´–í–û–î–´

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã

‚úÖ **Veo 3.1 —Å—Ç–æ–∏–º–æ—Å—Ç—å:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∞—è –Ω–µ–¥–æ–æ—Ü–µ–Ω–∫–∞ (21x)
‚úÖ **–≠–∫–æ–Ω–æ–º-—Ä–µ–∂–∏–º:** –†–∞—Å—Ö–æ–¥—ã —Å–Ω–∏–∂–µ–Ω—ã –Ω–∞ 50% (4 —Å–µ–∫ –≤–º–µ—Å—Ç–æ 8)
‚úÖ **–û—à–∏–±–∫–∞ —Å —Ñ–æ—Ç–æ:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ root cause (file_id conflicts)
‚úÖ **Cost-Guard:** –ó–∞—â–∏—Ç–∞ –æ—Ç —á—Ä–µ–∑–º–µ—Ä–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –≤–Ω–µ–¥—Ä–µ–Ω–∞
‚úÖ **Rate limiting:** 2 –∑–∞–ø—Ä–æ—Å–∞/—á–∞—Å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è Veo
‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤—Å–µ—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤

### –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- Veo 8 —Å–µ–∫: —Å–ø–∏—Å—ã–≤–∞–ª–æ—Å—å 15,000 —Ç–æ–∫–µ–Ω–æ–≤ ($0.15)
- –†–µ–∞–ª—å–Ω–æ —Ç—Ä–∞—Ç–∏–ª–æ—Å—å: $3.20
- –£–±—ã—Ç–æ–∫ –Ω–∞ 1 –∑–∞–ø—Ä–æ—Å: **$3.05**
- –ü—Ä–∏ 100 –∑–∞–ø—Ä–æ—Å–∞—Ö/–¥–µ–Ω—å: **-$305/–¥–µ–Ω—å**

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- Veo 4 —Å–µ–∫ (—ç–∫–æ–Ω–æ–º): —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è 160,000 —Ç–æ–∫–µ–Ω–æ–≤ ($1.60)
- –†–µ–∞–ª—å–Ω–æ —Ç—Ä–∞—Ç–∏—Ç—Å—è: $1.60
- –£–±—ã—Ç–æ–∫: **$0**
- –ü—Ä–∏ 100 –∑–∞–ø—Ä–æ—Å–∞—Ö/–¥–µ–Ω—å: **$0 —É–±—ã—Ç–∫–∞, $160 —á–µ—Å—Ç–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞**

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è: ~$460/–¥–µ–Ω—å –ø—Ä–∏ 100 –∑–∞–ø—Ä–æ—Å–∞—Ö**

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ

‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (cost_guard, temp_files)
‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ (UUID + cleanup)
‚úÖ Rate limiting –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π
‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è —Å–∏—Å—Ç–µ–º–∞ (–ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏)

---

**–û—Ç—á—ë—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª:** Senior Code Auditor
**–î–∞—Ç–∞:** 2025-12-17
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã
